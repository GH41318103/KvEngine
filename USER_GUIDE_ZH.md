# ğŸ“– KvEngine ä½¿ç”¨èªªæ˜æ›¸ (User Guide)

> [!NOTE]
> **KvEngine** æ˜¯ä¸€å€‹ä»¥ C++11 æ‰“é€ çš„é«˜æ•ˆã€è¼•é‡ç´šåµŒå…¥å¼éµå€¼å­˜å„²å¼•æ“ã€‚å°ˆç‚ºè³‡æºå—é™ç’°å¢ƒè¨­è¨ˆï¼Œæä¾›å¯é çš„è³‡æ–™æŒä¹…åŒ–ã€ç¯„åœæŸ¥è©¢æ”¯æ´ä»¥åŠ ACID äº‹å‹™è™•ç†èƒ½åŠ›ã€‚

---

## ğŸš€ æ ¸å¿ƒç‰¹æ€§ (Key Features)

- **é«˜æ•ˆç´¢å¼•**ï¼šåŸºæ–¼ **B+ æ¨¹** å¯¦ç¾ï¼Œæ”¯æ´ O(log n) ç­‰ç´šçš„éš¨æ©Ÿå­˜å–èˆ‡æœ‰åºç¯„åœæƒæã€‚
- **è¼•é‡åŒ–è¨­è¨ˆ**ï¼šæ ¸å¿ƒå¼•æ“å®šç¾©ç²¾ç°¡ï¼ˆ< 1MBï¼‰ï¼Œæ¥µæ˜“æ•´åˆè‡³åµŒå…¥å¼æˆ– IoT è¨­å‚™ã€‚
- **è³‡æ–™å®‰å…¨**ï¼šæ¡ç”¨ **WAL (Write-Ahead Logging)** æŠ€è¡“ï¼Œç¢ºä¿å´©æ½°å¾Œæ•¸æ“šå¯å®Œæ•´æ¢å¾©ã€‚
- **ACID äº‹å‹™**ï¼šé€é **2PL (Two-Phase Locking)** æ©Ÿåˆ¶ä¿è­‰æ“ä½œçš„åŸå­æ€§èˆ‡ä¸€è‡´æ€§ã€‚
- **ç·©è¡æ± ç®¡ç†**ï¼šå…§å»º **LRU ç·©è¡æ± **ï¼Œå¤§å¹…å„ªåŒ–ç£ç›¤ I/O ä¸¦æå‡ç†±é»æ•¸æ“šè®€å¯«æ•ˆèƒ½ã€‚
- **Redis å”è­°å…¼å®¹**ï¼šåŸç”Ÿæ”¯æ´ **RESP å”è­°**ï¼Œå¯ç›´æ¥ä½¿ç”¨ç¾æˆçš„ Redis å·¥å…·éˆé€£ç·šã€‚

---

## ğŸ› ï¸ ç’°å¢ƒè¦æ±‚èˆ‡å¿«é€Ÿé–‹å§‹

### ğŸ“‹ ç’°å¢ƒè¦æ±‚
- **ç·¨è­¯å™¨**: GCC 5.0+, Clang 3.8+, æˆ– MSVC 2015+
- **æ¨™æº–**: C++11 æˆ–æ›´é«˜ç‰ˆæœ¬
- **å·¥å…·**: CMake 3.10+

### âš™ï¸ ç·¨è­¯æ­¥é©Ÿ
```bash
# 1. å»ºç«‹ä¸¦é€²å…¥æ§‹å»ºç›®éŒ„
mkdir build && cd build

# 2. ç”Ÿæˆæ§‹å»ºæ–‡ä»¶ (æ¨è–¦ Release æ¨¡å¼ä»¥ç²å¾—æœ€ä½³æ•ˆèƒ½)
cmake .. -DCMAKE_BUILD_TYPE=Release

# 3. é€²è¡Œç·¨è­¯ (ä½¿ç”¨å¤šæ ¸å¿ƒåŠ é€Ÿ)
make -j$(nproc)
```

---

## ğŸ“– C++ API ä½¿ç”¨æŒ‡å—

### ğŸ”§ åŸºç¤æ“ä½œèˆ‡äº‹å‹™
```cpp
#include <kvengine/kv_engine.h>
#include <iostream>

int main() {
    // 1. åˆå§‹åŒ–å¼•æ“ä¸¦æŒ‡å®šæ•¸æ“šç›®éŒ„
    KvEngine engine("./data");
    if (!engine.open()) return 1;

    // 2. åŸºæœ¬è®€å¯« (Put/Get)
    engine.put("user:1", "Antigravity");
    std::string val = engine.get("user:1");

    // 3. å®‰å…¨çš„äº‹å‹™è™•ç†
    engine.begin_transaction();
    try {
        engine.put("account:A", "500");
        engine.put("account:B", "1500");
        engine.commit();
    } catch (...) {
        engine.rollback(); // ç™¼ç”Ÿç•°å¸¸æ™‚è‡ªå‹•å›æ»¾
    }

    // 4. é«˜æ•ˆæ‰¹é‡å¯«å…¥ (Batch Put)
    std::map<std::string, std::string> batch = {{"k1", "v1"}, {"k2", "v2"}};
    engine.batch_put(batch);

    engine.close();
    return 0;
}
```

---

## ğŸ›¡ï¸ æ•¸æ“šå¯é æ€§èˆ‡æ€§èƒ½å„ªåŒ–

### ğŸ”„ æ•…éšœæ¢å¾© (WAL)
> [!IMPORTANT]
> **è‡ªå‹•ä¿®å¾©**ï¼šå•Ÿå‹•æ™‚è‹¥åµæ¸¬åˆ°ç•°å¸¸ä¸­æ–·ï¼Œå¼•æ“æœƒè‡ªå‹•åŸ·è¡Œ **Analysis -> Redo -> Undo** æµç¨‹ï¼Œç¢ºä¿è³‡æ–™åº«å›æ­¸ä¸€è‡´ç‹€æ…‹ã€‚
- **Checkpoint**ï¼šç³»çµ±è‡ªå‹•å®šæœŸåˆ·ç›¤ï¼Œå›æ”¶èˆŠæ—¥èªŒä¸¦ç¸®çŸ­å•Ÿå‹•æ¢å¾©æ™‚é–“ã€‚

### ğŸï¸ æ€§èƒ½å»ºè­°
- **å„ªå…ˆä½¿ç”¨ Batch Put**ï¼šå°‡å¤šç­†å¯«å…¥åˆä½µç‚ºä¸€å€‹æ‰¹æ¬¡ï¼Œèƒ½å°‡ç£ç›¤ I/O é »ç‡é™è‡³æœ€ä½ï¼Œæ•ˆèƒ½é€šå¸¸æ¯”å–®æ¬¡ Put æå‡æ•¸å€ã€‚

---

## ğŸŒ ç¶²çµ¡ä¼ºæœå™¨ (Redis å…¼å®¹)

### ğŸ›°ï¸ å•Ÿå‹•æœå‹™
```bash
# æ ¼å¼: ./kv_server [åŸ å£] [æ•¸æ“šç›®éŒ„]
./kv_server 6379 ./data
```

### âŒ¨ï¸ æ”¯æ´æŒ‡ä»¤ (Commands)
| æŒ‡æ¨™ | ç”¨æ³• | èªªæ˜ |
| :--- | :--- | :--- |
| **PING** | `PING [msg]` | æ¸¬è©¦é€£ç·šã€‚å›å‚³ `PONG` æˆ–è‡ªå®šç¾©è¨Šæ¯ã€‚ |
| **SET** | `SET key val` | è¨­ç½®å­—ä¸²éµå€¼ã€‚ |
| **GET** | `GET key` | ç²å–å€¼ã€‚ä¸å­˜åœ¨å‰‡å›å‚³ `(nil)`ã€‚ |
| **DEL** | `DEL k1 [k2]` | åˆªé™¤éµã€‚å›å‚³æˆåŠŸåˆªé™¤çš„å€‹æ•¸ã€‚ |
| **KEYS** | `KEYS pattern`| æœå°‹éµã€‚æ”¯æ´ `*` å‰ç¶´æœå°‹ (å¦‚ `u:*`)ã€‚ |

> [!TIP]
> **Python å¿«é€Ÿæ¸¬è©¦**ï¼šå°ˆæ¡ˆæ ¹ç›®éŒ„é™„å¸¶ `client.py`ï¼Œå•Ÿå‹•ä¼ºæœå™¨å¾Œç›´æ¥åŸ·è¡Œ `python client.py` å³å¯é€²å…¥äº’å‹•ä»‹é¢ã€‚

---

## ğŸ“‚ å°ˆæ¡ˆæ¶æ§‹
- `include/`: API å®šç¾©èˆ‡é ­æ–‡ä»¶ã€‚
- `src/`: æ ¸å¿ƒå¼•æ“èˆ‡ç¶²çµ¡å±¤å¯¦ä½œã€‚
- `test/`: å®Œå‚™çš„å–®å…ƒæ¸¬è©¦ã€‚
- `examples/`: æ›´å¤šç¯„ä¾‹ä»£ç¢¼ (å¦‚ `batch_operations.cpp`)ã€‚
